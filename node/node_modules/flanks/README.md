# flanks-node [![npm version](https://img.shields.io/npm/v/flanks.svg?color=green)](https://www.npmjs.com/package/flanks)
Node.js client for Flanks API.

## Install

```console
$ npm install flanks
```

## Getting started
This module enables Node.js developers to easily access all Flanks API endpoints.  
  
First, include the `flanks` module in your desired `.js` files:  
```js
const flanks = require('flanks');
```
Then, you can start using the supported endpoints. This module is using endpoints from a stateful sandbox environment.  
You can find the complete API Documentation [here](https://docs.flanks.io/ "Flanks API Docs").

### Token overview
Most API requests interact with a `user_token` or a set of `credentials` (map of key-value pairs) associated with a financial institution. A single end-user of your application might have accounts at different financial institutions.  
Credit and depository accounts may also have transactions associated with them.  
  
That `user_token` or `credentials` uniquely identify the account. You can use the `access_token` along with your `OAuth Token` to access products available for an account and make changes to it over time.  

**Important**: remember to pass your `OAUTH_TOKEN` as an environment variable when calling your script.
```console
$ OAUTH_TOKEN=<YOUR_OAUTH_TOKEN> node script.js
```

## Accessing data

Once you create an `user_token`, you can then access data—such as transaction data, account information and routing numbers—using our API endpoints. You access data using the `user_token`, which is specific to your API keys and cannot be shared or used by any other API keys. By default, an `user_token` never expires, but it can rotate.  

### Creating a user

Now that you have API keys and know the basics of the Flanks API, it is time to integrate with flank's clients, which will handle credential validation, multi-factor authentication, and error handling for each institution that we support.  
  
Clients allow interaction with the Flanks system in an easier and faster way. We currently have different clients that are integrated with the main important market languages. In our clients, previous validations are incorporated to save calls to the system and speed up the interaction with it.  

A user can be created as follows:  
```js
flanks.createUser({
    user: 'user',
    password: 'password',
    bank: 'bank',
}).then(response => {
    console.log(response.data);
}).catch(err => {
    console.error(err);
});
```
The following is a successful response:
```json
{
  "user_token": "<YOUR_USER_TOKEN>",
  "message": "User created successfully"
}
```

### Pulling financial data
Once you have a `user_token`, you can use it to access financial information without need to input passwords periodically:  

```js
flanks.getAccountData({
    user_token: '<YOUR_USER_TOKEN>',
}).then(response => {
    console.log(response.data);
}).catch(err => {
    console.error(err);
});
```

A successful response has the following schema:

```json
{
  "account": {
    "alias": "string",
    "amount": {
      "value": null,
      "currency": "string"
    },
    "availability": "string",
    "bank": "string",
    "description": "string",
    "iban": "string",
    "isOwner": true,
    "numOwners": null,
    "owner": "string"
  },
  "amount": null,
  "balance": null,
  "bank": "string",
  "cardNumber": "string",
  "category": "string",
  "currency": "string",
  "dateOperation": "yyyy-mm-dd",
  "dateValue": "yyyy-mm-dd",
  "description": "string",
  "expense": true,
  "id": "string",
  "productDescription": "string",
  "service": "string",
  "transfer": {
    "beneficiary": "string",
    "ibanBeneficiary": "string",
    "ibanOrdenant": "string",
    "ordenant": "string"
  }
}
```

### Using credentials to pull data
A faster but less secure way to access the financial data of a bank account is by directly attaching the credentials in the request:

```js
flanks.getAccountData({
    user: 'user',
    password: 'password',
    bank: 'bank',
}).then(response => {
    console.log(response.data);
}).catch(err => {
    console.error(err);
});
```

This request is equivalent to the previous one.  

## Using ES2017 async/await

You can also use the new `async/await` keywords introduced in ECMAScript 2017. For example, inside an `async` function, you could pull data like this:  

```js
async function foo() {
  try {
    const response = await flanks.getAccountData({ user_token: '<YOUR_USER_TOKEN>' });
    console.log(response.data);  
  } catch (err) {
    console.error(err);
  }
}
```
